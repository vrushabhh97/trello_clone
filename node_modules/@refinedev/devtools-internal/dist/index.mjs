"use client"
import I from"error-stack-parser";var T="renderWithHooks",m=r=>{let e=r.findIndex(n=>n.functionName===T);return e!==-1?r.slice(0,e):r};var f=process.env.NODE_ENV!=="development"?/node_modules\/refinedev\/(?<name>.*?)\//:/\/refine\/packages\/(?<name>.*?)\//;var y=r=>r?!!r.match(f):!1;var E=r=>{var o;if(!r)return;let e=r.match(f),n=(o=e==null?void 0:e.groups)==null?void 0:o.name;if(n)return`@refinedev/${n}`};function p(r){if(process.env.NODE_ENV!=="development")return[];try{let e=new Error,n=I.parse(e);return m(n).map(t=>({file:t.fileName,line:t.lineNumber,column:t.columnNumber,function:t.functionName,isRefine:y(t.fileName),packageName:E(t.fileName)})).filter(t=>t.function).filter(t=>!(r!=null&&r.includes(t.function??""))).slice(1)}catch{return[]}}import{scopes as u}from"@refinedev/devtools-shared";var d=(r,e)=>{if(u[r]==="auth")return null;if(r==="useCan")return e?"key[1].resource":"key[1]";if(u[r]==="audit-log")return r==="useLog"?"variables.resource":"key[1]";if(u[r]==="data"){if(r==="useCustom"||r==="useCustomMutation")return null;switch(r){case"useList":case"useInfiniteList":case"useOne":case"useMany":return e?"key[1]":"key[2]";case"useCreate":case"useCreateMany":case"useDelete":case"useDeleteMany":case"useUpdate":case"useUpdateMany":return"variables.resource"}}return null};function P(r,e,n,o){if(process.env.NODE_ENV!=="development")return{hookName:"",trace:[],resourcePath:null,legacyKey:!1};let s=p(o).slice(1),t=d(r,e);return{hookName:r,trace:s,resourcePath:t,legacyKey:e,resourceName:n}}import{DevToolsContext as D,DevtoolsEvent as N,receive as k}from"@refinedev/devtools-shared";import i,{useContext as A}from"react";import{DevtoolsEvent as _,send as g}from"@refinedev/devtools-shared";var l=(r,e)=>{let n=e==null?void 0:e.map(s=>`${s.file}:${s.line}:${s.column}#${s.function}-${s.packageName}-${s.isRefine?1:0}`);return JSON.stringify([...r??[],...n??[]])};var R=r=>e=>{var o;if(!((o=e==null?void 0:e.meta)!=null&&o.trace))return;let n=e==null?void 0:e.meta;new Promise(s=>{var t,a;g(r,_.ACTIVITY,{type:"mutation",identifier:l(e==null?void 0:e.options.mutationKey,(t=e==null?void 0:e.meta)==null?void 0:t.trace),key:e==null?void 0:e.options.mutationKey,status:e==null?void 0:e.state.status,state:e==null?void 0:e.state,variables:(a=e==null?void 0:e.state)==null?void 0:a.variables,...n}),s()})},v=r=>e=>{var o;if(!((o=e==null?void 0:e.meta)!=null&&o.trace))return;let n=e==null?void 0:e.meta;new Promise(s=>{var t;g(r,_.ACTIVITY,{type:"query",identifier:l(e.queryKey,(t=e.meta)==null?void 0:t.trace),key:e.queryKey,status:e.state.status,state:e.state,...n}),s()})};var b=process.env.NODE_ENV!=="development"?()=>({}):r=>{let{ws:e}=A(D),n=i.useRef(),o=i.useRef();return i.useEffect(()=>{if(!e)return()=>0;let s=r.getQueryCache(),t=v(e);return s.getAll().forEach(t),n.current=s.subscribe(({query:a,type:c})=>(c==="added"||c==="updated")&&t(a)),()=>{var a;(a=n.current)==null||a.call(n)}},[e,r]),i.useEffect(()=>{if(!e)return()=>0;let s=r.getMutationCache(),t=R(e);return s.getAll().forEach(t),o.current=s.subscribe(({mutation:a,type:c})=>(c==="added"||c==="updated")&&t(a)),()=>{var a;(a=o.current)==null||a.call(o)}},[e,r]),i.useEffect(()=>e?k(e,N.DEVTOOLS_INVALIDATE_QUERY_ACTION,({queryKey:t})=>{t&&r.invalidateQueries(t)}):()=>0,[e,r]),{}};export{p as getTrace,P as getXRay,b as useQuerySubscription};
//# sourceMappingURL=index.mjs.map